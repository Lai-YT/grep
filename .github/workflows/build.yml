name: CI

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-22.04
    name: Build project
    steps:
    - name: Update apt
      run: sudo apt update
    - name: Install Make & CMake
      # CMake is needed for the installation of cmocka
      run:  sudo apt install make cmake
      shell: sh
    - name: Install Valgrind
      run: sudo apt install -y valgrind
    - name: Checkout repo
      uses: actions/checkout@v3
    - name: Install cmocka
      run: |
        SCRIPT='./.github/scripts/install_cmocka.sh'
        chmod +x "$SCRIPT" && "$SCRIPT"
    - name: Compile regexp
      run: make release
